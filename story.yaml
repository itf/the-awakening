#############
# FOR DEVELOPERS ONLY
# 
# There are 2 types of structures: TEXT and WORDS
# WORDS are clickable.
# TEXT contain words.
#
# FLAGS:
# When you click on a WORD, it might set a flag, that can be used for conditionals.
# For convenience, the keyword of the text substitution is automatically added as a flag 
# whose value increase by 1 for every turn the text is present. It is removes as soon as the text is not displayed any longer.
#
# TEXT-KEYWORDS:
# You have access to the keywords of the texts that are being displayed, which can be used to modify the behavior of the WORDS.
# 
# OBS:
# The code make use of the id of the words, in such a way that if there is more than one of the same word on the screen, only one of them will be accessed.
#
# Timed Events (BETA and in construction):
###############

begin:
    text: $start$ $end$ $end2$

rooftop-start:
    - cond: 
        flags: rooftop-darkness
      text: It is nice and dark on this [rooftop-rft-1]. $rooftop_state$
    - cond: 
        flags: f-beautiful-sky
      text: You are on a [rooftop-rft-1], under the moonlight. $rooftop_state$
    - cond: 
        flags: f-dark-sky
      text: You are on a [dark-rft] [rooftop-rft-1]. $rooftop_state$
    - text: You are on a [rooftop-rft-1]. $rooftop_state$
    
rooftop-any:
    - cond:
       flags: 
         - f-any-other-rooftop
         - f-beautiful-sky
      text: It's a shimmering [rooftop-rft-3], with some [vents-rft], a [ledge-rft] and some pipes lying around. $rooftop_characteristics$
    - cond:
       flags: 
         f-any-other-rooftop
      text: It's just a [rooftop-rft-3], with some [vents-rft], a [ledge-rft] and some pipes lying around. $rooftop_characteristics$
    - cond:
        flags:
          f-beautiful-sky
      text: You are on a shimmering [rooftop-rft-3] like [any_other-rft]. $rooftop_characteristics$
    - text: You are on a [rooftop-rft-3] like [any_other-rft]. $rooftop_characteristics$

rooftop-vents: 
  text: You walk towards the [vents-rft-2] and notice that they are open$rooftop_vents$ 

rooftop-vents-inside:
  text: ", so you decide to enter them. <br>Inside the [vents-rft-3], it is too dark to see anything$rooftop_vents_2$ "

rooftop-vents-stop-entering:
  text: ", so you decide not to enter. You tremble at the view of this dark entrance under this somber sky. <br><br> Maybe if you were more used to the darkness you would venture inside the vents."
  cond:
    not_flags: 
       shadows-rft

rooftop-vents-escape-shadows:
    text: ", but you decide to enter to escape the shadows. You tremble at the view of this dark entrance under this somber sky. <br><br> You hide just long enough to escape from the shadows that were following you."
    rm_flags: shadows-rft
    flags: f-escaped-shadows-rft
    cond:
      flags:
        shadows-rft

rooftop-vents-inside-2:
  - text: ", but you are hardcore and decide to continue. <br> <br> Even without your headlamp you keep crawling relentlessly through the ventilation pipes. 
<br> <br>
The moonlight, entering through the vent allowed you to avoid falling to the basement through one of the pipes near the entrance.
<br><br>
However you didn't notice that ahead on your path was a second vertical pipe connected to the basement, and tried crawling over it."
    cond:
      flags:
          f-beautiful-sky
  - text: ", but you are hardcore and decide to continue. <br> <br> Even without your headlamp you keep crawling relentlessly through the ventilation pipes.
<br> <br>
You didn't notice that ahead on your path was a vertical pipe connected to the basement, and tried crawling over it."

rooftop-ledge:
  text: You walk towards the ledge and look down. <br> It is a long [fall-rft-ledge]. $rooftop_falling$

rooftop-falling-wind:
  text: <br> <br> You hear the wind rushing through you ears.

rooftop-any-other:
    - text: This rooftop seems darker than usual, but you've been to too many dark rooftops to care about this one.
      cond:
        flags:
          f-dark-sky
    - text: You've been to too many rooftops to care about them anymore.
    
rooftop-dark-state:
    text: It's [night-rft].
    
rooftop-shadows-state:
    text: "[shadows-rft] are dancing in the distance."
    cond:
      not_flags:
        - f-escaped-shadows-rft

rooftop-dark-escaped-shadows:
  text: You feel a bit at home in this [darkness-rft]$rooftop-darkness$ 
  cond:
    flags:
      - f-escaped-shadows-rft

rooftop-darkness-forest:
  text: "; it reminds you of the forests you used to explore. $rooftop-darkness-forest$"

rooftop-night:
    - text: It's just another [night-rft-sky] on the [rooftop-rft-2]. $sky_state$
      cond:
        flags: f-dark-sky
    - text: It's [night-rft-sky] on the [rooftop-rft-2]. $sky_state$
    
rooftop-dark-night:
    text: The [sky-rft-sky] is [dark-rft-sky].
    
rooftop-beautiful-night:
    text: You see the [beautiful-rft-sky] night [sky-rft-sky]$beautiful_sky_state$

rooftop-moon-shining:
    text: ", where the [moon-rft-sky] is shining brightly. $moon-shining$"

rooftop-moon-forest:
    text: "<br> The bright moonlight is reflected by the crowns of some [trees-rft-sky] by the horizon$moon-tree$"

rooftop-moon-forest-2:
   text: ". <br> <br> Your eyes are drawn to the [forest-rft] ahead. $moon-forest$"

rooftop-moon-forest-3:
  text: <br> You can almost feel the smell from the fallen [leaves-rft]$moon-leaves$

rooftop-moon-forest-bark-smell:
  text: ", as well as the smell from the tree barks. $tree-barks$"

rooftop-forest-transition:
  text: <br> The [forest-rft-frt]. $forest-forest$



forest-start:
  text: <br><br>You find yourself in a forest.
.:
  text: .
  
END:
    text: <br><br> ✴✴✴  ✴✴✴ <br> [undo]?

END-SHADOW:
   text: <br><br> The shadows caught you.
  

################################
# Words describing the rooftop
rooftop-rft-1:
    word: rooftop
    click:
        - cond: 
            flags:
                - f-investigate-rooftop
          subs:
            start: rooftop-any
          flags: 
            - f-investigate-rooftop: 1
        - cond: 
          flags: 
            - f-investigate-rooftop: 1
          subs:
            rooftop_state: rooftop-dark-state
              
rooftop-rft-2:
    word: rooftop
    click:
        - cond:
          flags: 
          subs:
            start: rooftop-start
          rm-flags: 

rooftop-rft-3:
    word: rooftop
    click:
        - cond: 
            flags: tasa
          subs:
            start: rooftop-start
          rm-flags: 
        - cond: 
          subs:
            start: rooftop-start
          rm-flags: 

night-rft:
    word: night
    click:
          - subs:
                start: rooftop-night
            flags:  

dark-rft: 
    word: dark
    click:
          - cond: 
              flags:
                - f-escaped-shadows-rft
            subs:
              rooftop_state: rooftop-dark-escaped-shadows
              rooftop-darkness: .
          - cond: 
              flags:
                - f-investigate-rooftop
                - f-dark-sky
            subs:
              rooftop_state: rooftop-shadows-state
            body_class:
              flash-dark

darkness-rft:
  word: darkness
  click:
    - body_style: 
        flash-dark
      subs:
        rooftop-darkness: rooftop-darkness-forest

any_other-rft:
    word: any other
    click:
        - cond:
            not_flags: 
                - f-any-other-rooftop
          subs:
            rooftop_characteristics: rooftop-any-other
          flags: 
            - f-any-other-rooftop

############
# Sky at the rooftop
night-rft-sky:
    word: night
    click:
        - subs:
            sky_state: rooftop-dark-night


sky-rft-sky:
    word: sky
    click:
        - subs:
            sky_state: rooftop-beautiful-night
            beautiful_sky_state: .
          cond:
            not_flags: rooftop-beautiful-night
    
dark-rft-sky:
    word: dark
    click:
        - subs:
          flags: 
            - f-dark-sky
          body_class: 
            - flash-dark
          rm_flags:
            - f-beautiful-sky
beautiful-rft-sky:
    word: beautiful
    click:
        - subs: 
            beautiful_sky_state: rooftop-moon-shining
          rm_flags:
            - f-dark-sky
          flags: 

moon-rft-sky:
    word: moon
    click:
        - subs: 
             moon-shining: rooftop-moon-forest
             moon-tree: .
          rm_flags:
          flags: f-beautiful-sky

trees-rft-sky:
    word: trees
    click:
        - subs: 
            moon-tree: rooftop-moon-forest-2             
          rm_flags:
          flags: 
vents-rft:
  word: vents
  click:
    - subs:
        rooftop_characteristics: rooftop-vents
        rooftop_vents: .

vents-rft-2:
  word: vents
  click:
    - subs:
        rooftop_vents: rooftop-vents-inside
        rooftop_vents_2: .

vents-rft-3:
  word: vents
  click:
    - cond:
        flags: shadows-rft
      subs:
        rooftop_vents_2: rooftop-vents-escape-shadows
    - cond:
        flags:
          f-dark-sky
      subs:
        rooftop_vents_2: rooftop-vents-stop-entering
      body_class: 
       - flash-dark
    - subs:
        rooftop_vents_2: rooftop-vents-inside-2
        end: END
      body_class: 
       - flash-red


ledge-rft:
  word: ledge
  click:
    - subs:
        rooftop_characteristics: rooftop-ledge

fall-rft-ledge:
  word: fall
  click:
    - m: True
      body_class: 
      - flash-red
      subs:
        rooftop_falling: rooftop-falling-wind
        end: END
      
shadows-rft:
  word: Shadows
  auto:
    - flags:
        f-shadow-attacked
      cond:
        not_flags:
            f-shadow-attacked
      time: 20
      e:
        - subs:
            end: END-SHADOW
            end2: END
          body_class: flash-red
          
        

forest-rft:
  word: forest
  click:
    - cond:
        flags:
          f-leaves-rft
      subs:
        tree-barks: rooftop-forest-transition
    - subs:
        moon-forest: rooftop-moon-forest-3
        moon-leaves: .

leaves-rft:
  word: leaves
  click:
    flags:
      f-leaves-rft
    subs: 
      moon-leaves: rooftop-moon-forest-bark-smell

forest-rft-frt:
  word: forest
  click:
    subs:
      forest-forest: forest-start

undo:
  word: Undo
  click:
    m: True
    end: True
    undo: True